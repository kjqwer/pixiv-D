# Pixiv åç«¯æœåŠ¡

Pixiv åç«¯æœåŠ¡æ¶æ„ï¼Œæä¾›ä½œå“ä¿¡æ¯è·å–ã€ä½œè€…ä¿¡æ¯æŸ¥è¯¢ã€æ–‡ä»¶ä¸‹è½½ç­‰åŠŸèƒ½ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
backend/
â”œâ”€â”€ server.js              # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ core.js                # æ ¸å¿ƒåç«¯é€»è¾‘
â”œâ”€â”€ auth.js                # è®¤è¯æ¨¡å—
â”œâ”€â”€ config.js              # ä»£ç†é…ç½®
â”œâ”€â”€ start.js               # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test-login.js          # ç™»å½•æµ‹è¯•è„šæœ¬
â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.js           # è®¤è¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ errorHandler.js   # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”œâ”€â”€ routes/               # è·¯ç”±æ¨¡å—
â”‚   â”œâ”€â”€ auth.js          # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ artwork.js       # ä½œå“è·¯ç”±
â”‚   â”œâ”€â”€ artist.js        # ä½œè€…è·¯ç”±
â”‚   â”œâ”€â”€ download.js      # ä¸‹è½½è·¯ç”±
â”‚   â”œâ”€â”€ ranking.js       # æ’è¡Œæ¦œè·¯ç”±
â”‚   â””â”€â”€ repository.js    # ä»“åº“ç®¡ç†è·¯ç”±
â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ artwork.js       # ä½œå“æœåŠ¡
â”‚   â”œâ”€â”€ artist.js        # ä½œè€…æœåŠ¡
â”‚   â”œâ”€â”€ download.js      # ä¸‹è½½æœåŠ¡
â”‚   â”œâ”€â”€ ranking.js       # æ’è¡Œæ¦œæœåŠ¡
â”‚   â””â”€â”€ repository.js    # ä»“åº“ç®¡ç†æœåŠ¡
â””â”€â”€ utils/               # å·¥å…·ç±»
    â””â”€â”€ response.js      # å“åº”å·¥å…·
```

## ğŸ“¡ API æ¥å£

### è®¤è¯ç›¸å…³

- `GET /api/auth/status` - è·å–ç™»å½•çŠ¶æ€
- `GET /api/auth/login-url` - è·å–ç™»å½•URL
- `POST /api/auth/callback` - å¤„ç†ç™»å½•å›è°ƒ
- `POST /api/auth/relogin` - é‡æ–°ç™»å½•
- `POST /api/auth/logout` - ç™»å‡º

### ä½œå“ç›¸å…³

- `GET /api/artwork/search` - æœç´¢ä½œå“
  - å‚æ•°: `keyword`, `type`, `sort`, `duration`, `offset`, `limit`
- `GET /api/artwork/:id` - è·å–ä½œå“è¯¦æƒ…
  - å‚æ•°: `include_user`, `include_series`
- `GET /api/artwork/:id/preview` - è·å–ä½œå“é¢„è§ˆ
- `GET /api/artwork/:id/images` - è·å–ä½œå“å›¾ç‰‡URL
  - å‚æ•°: `size` (small/medium/large/original)
- `GET /api/artwork/:id/related` - è·å–ç›¸å…³æ¨èä½œå“
  - å‚æ•°: `offset`, `limit`

### æ’è¡Œæ¦œç›¸å…³

- `GET /api/ranking` - è·å–æ’è¡Œæ¦œæ•°æ®
  - å‚æ•°: `mode` (day/week/month), `type` (art/manga/novel), `offset`, `limit`

### ä½œè€…ç›¸å…³

- `GET /api/artist/following` - è·å–å½“å‰ç”¨æˆ·å…³æ³¨çš„ä½œè€…åˆ—è¡¨
  - å‚æ•°: `offset`, `limit`
- `GET /api/artist/:id/artworks` - è·å–ä½œè€…ä½œå“åˆ—è¡¨
  - å‚æ•°: `type`, `filter`, `offset`, `limit`
- `GET /api/artist/:id/following` - è·å–ä½œè€…å…³æ³¨åˆ—è¡¨
  - å‚æ•°: `restrict`, `offset`, `limit`
- `GET /api/artist/:id/followers` - è·å–ä½œè€…ç²‰ä¸åˆ—è¡¨
  - å‚æ•°: `restrict`, `offset`, `limit`
- `POST /api/artist/:id/follow` - å…³æ³¨/å–æ¶ˆå…³æ³¨ä½œè€…
  - å‚æ•°: `restrict` (public/private)

### ä¸‹è½½ç›¸å…³

- `POST /api/download/artwork/:id` - ä¸‹è½½å•ä¸ªä½œå“
  - å‚æ•°: `size`, `quality`, `format`
- `POST /api/download/artworks` - æ‰¹é‡ä¸‹è½½ä½œå“
  - å‚æ•°: `artworkIds`, `size`, `quality`, `format`, `concurrent`
- `POST /api/download/artist/:id` - ä¸‹è½½ä½œè€…ä½œå“
  - å‚æ•°: `type`, `filter`, `size`, `quality`, `format`, `concurrent`
- `POST /api/download/ranking` - ä¸‹è½½æ’è¡Œæ¦œä½œå“
  - å‚æ•°: `mode`, `type`, `limit`, `size`, `quality`, `format`
- `GET /api/download/progress/:taskId` - è·å–ä¸‹è½½è¿›åº¦
- `DELETE /api/download/cancel/:taskId` - å–æ¶ˆä¸‹è½½ä»»åŠ¡
- `GET /api/download/history` - è·å–ä¸‹è½½å†å²
  - å‚æ•°: `offset`, `limit`

#### ä»»åŠ¡ç®¡ç†APIï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰

- `GET /api/download/tasks` - è·å–æ‰€æœ‰ä»»åŠ¡ï¼ˆå®Œæ•´æ•°æ®ï¼‰
- `GET /api/download/tasks/active` - è·å–æ´»è·ƒä»»åŠ¡ï¼ˆä¸‹è½½ä¸­æˆ–æš‚åœï¼‰
- `GET /api/download/tasks/summary` - è·å–ä»»åŠ¡æ‘˜è¦ï¼ˆå¿«é€ŸçŠ¶æ€æ£€æŸ¥ï¼‰
- `GET /api/download/tasks/changes` - è·å–ä»»åŠ¡å˜æ›´ï¼ˆå¢é‡æ›´æ–°ï¼‰
  - å‚æ•°: `since` (æ—¶é—´æˆ³ï¼Œè·å–æŒ‡å®šæ—¶é—´åçš„å˜æ›´)
- `GET /api/download/tasks/completed` - è·å–å·²å®Œæˆä»»åŠ¡ï¼ˆåˆ†é¡µï¼‰
  - å‚æ•°: `offset`, `limit`

### ä»£ç†ç›¸å…³

- `GET /api/proxy/image` - å›¾ç‰‡ä»£ç†æœåŠ¡
  - å‚æ•°: `url` (å›¾ç‰‡URL)
- `GET /api/proxy/cache/stats` - è·å–å›¾ç‰‡ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
- `DELETE /api/proxy/cache` - æ¸…ç†æ‰€æœ‰å›¾ç‰‡ç¼“å­˜
- `DELETE /api/proxy/cache/expired` - æ¸…ç†è¿‡æœŸå›¾ç‰‡ç¼“å­˜
- `GET /api/proxy/cache/config` - è·å–ç¼“å­˜é…ç½®
- `PUT /api/proxy/cache/config` - æ›´æ–°ç¼“å­˜é…ç½®
- `POST /api/proxy/cache/config/reset` - é‡ç½®ç¼“å­˜é…ç½®ä¸ºé»˜è®¤å€¼

### APIç¼“å­˜ç®¡ç†ç›¸å…³

- `GET /api/proxy/api-cache/stats` - è·å–APIç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
- `DELETE /api/proxy/api-cache` - æ¸…ç†æ‰€æœ‰APIç¼“å­˜
- `DELETE /api/proxy/api-cache/expired` - æ¸…ç†è¿‡æœŸAPIç¼“å­˜
- `GET /api/proxy/api-cache/config` - è·å–APIç¼“å­˜é…ç½®
- `PUT /api/proxy/api-cache/config` - æ›´æ–°APIç¼“å­˜é…ç½®
- `POST /api/proxy/api-cache/config/reset` - é‡ç½®APIç¼“å­˜é…ç½®ä¸ºé»˜è®¤å€¼

### ä»“åº“ç®¡ç†ç›¸å…³

- `POST /api/repository/initialize` - åˆå§‹åŒ–ä»“åº“
- `GET /api/repository/config` - è·å–ä»“åº“é…ç½®
- `PUT /api/repository/config` - æ›´æ–°ä»“åº“é…ç½®
- `GET /api/repository/stats` - è·å–ä»“åº“ç»Ÿè®¡ä¿¡æ¯
- `GET /api/repository/artists` - è·å–ä½œè€…åˆ—è¡¨
  - å‚æ•°: `offset`, `limit`
- `GET /api/repository/artists/:artistName/artworks` - è·å–ä½œè€…ä½œå“åˆ—è¡¨
  - å‚æ•°: `offset`, `limit`
- `GET /api/repository/search` - æœç´¢ä½œå“
  - å‚æ•°: `q`, `offset`, `limit`
- `GET /api/repository/artworks/:artworkId` - è·å–ä½œå“è¯¦æƒ…
- `DELETE /api/repository/artworks/:artworkId` - åˆ é™¤ä½œå“
- `POST /api/repository/migrate` - è‡ªåŠ¨è¿ç§»æ—§é¡¹ç›®
  - å‚æ•°: `sourceDir` (æºç›®å½•è·¯å¾„)
- `GET /api/repository/preview` - æ–‡ä»¶é¢„è§ˆä»£ç†
  - å‚æ•°: `path` (æ–‡ä»¶è·¯å¾„)
- `GET /api/repository/file-info` - è·å–æ–‡ä»¶ä¿¡æ¯
  - å‚æ•°: `path` (æ–‡ä»¶è·¯å¾„)
- `GET /api/repository/directory` - è·å–ç›®å½•ç»“æ„
  - å‚æ•°: `path` (ç›®å½•è·¯å¾„)
- `GET /api/repository/check-downloaded/:artworkId` - æ£€æŸ¥ä½œå“æ˜¯å¦å·²ä¸‹è½½
- `GET /api/repository/check-directory` - æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
  - å‚æ•°: `path` (ç›®å½•è·¯å¾„)
- `POST /api/repository/migrate-old-to-new` - ä»æ—§ç›®å½•è¿ç§»åˆ°æ–°ç›®å½•
  - å‚æ•°: `oldDir` (æ—§ç›®å½•è·¯å¾„), `newDir` (æ–°ç›®å½•è·¯å¾„)

### å¾…çœ‹åå•ç›¸å…³

- `GET /api/watchlist` - è·å–æ‰€æœ‰å¾…çœ‹é¡¹ç›®
- `POST /api/watchlist` - æ·»åŠ å¾…çœ‹é¡¹ç›®
  - å‚æ•°: `url` (å¿…å¡«), `title` (å¯é€‰ï¼Œä¸æä¾›åˆ™è‡ªåŠ¨ç”Ÿæˆ)
- `PUT /api/watchlist/:id` - æ›´æ–°å¾…çœ‹é¡¹ç›®
  - å‚æ•°: `title` (é¡¹ç›®æ ‡é¢˜), `url` (é¡¹ç›®URL)
- `DELETE /api/watchlist/:id` - åˆ é™¤å¾…çœ‹é¡¹ç›®

## ğŸ”§ é…ç½®è¯´æ˜

### ä»£ç†é…ç½®

åœ¨ `config.js` ä¸­é…ç½®ä»£ç†è®¾ç½®ï¼š

### ç¯å¢ƒå˜é‡

- `PORT` - æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 3000)
- `NODE_ENV` - è¿è¡Œç¯å¢ƒ (development/production)
- `FRONTEND_URL` - å‰ç«¯URL (ç”¨äºCORS)

## ğŸ“ æ–‡ä»¶ç»“æ„è¯´æ˜

### æ ¸å¿ƒæ¨¡å—

- **server.js**: ä¸»æœåŠ¡å™¨ç±»ï¼Œè´Ÿè´£åˆå§‹åŒ–ã€é…ç½®å’Œå¯åŠ¨æœåŠ¡å™¨
- **core.js**: æ ¸å¿ƒåç«¯é€»è¾‘ï¼Œç®¡ç†è®¤è¯çŠ¶æ€å’Œé…ç½®
- **auth.js**: è®¤è¯æ¨¡å—ï¼Œå¤„ç†OAuth2.0ç™»å½•æµç¨‹

### ä¸­é—´ä»¶

- **auth.js**: è®¤è¯ä¸­é—´ä»¶ï¼ŒéªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
- **errorHandler.js**: å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶

### è·¯ç”±æ¨¡å—

- **auth.js**: è®¤è¯ç›¸å…³è·¯ç”±
- **artwork.js**: ä½œå“ç›¸å…³è·¯ç”±
- **artist.js**: ä½œè€…ç›¸å…³è·¯ç”±
- **download.js**: ä¸‹è½½ç›¸å…³è·¯ç”±
- **repository.js**: ä»“åº“ç®¡ç†è·¯ç”±
- **proxy.js**: ä»£ç†æœåŠ¡è·¯ç”±
- **watchlist.js**: å¾…çœ‹åå•è·¯ç”±

### æœåŠ¡å±‚

- **artwork.js**: ä½œå“æœåŠ¡ï¼Œå¤„ç†ä½œå“APIè°ƒç”¨
- **artist.js**: ä½œè€…æœåŠ¡ï¼Œå¤„ç†ä½œè€…APIè°ƒç”¨
- **download.js**: ä¸‹è½½æœåŠ¡ï¼Œå¤„ç†æ–‡ä»¶ä¸‹è½½
- **repository.js**: ä»“åº“ç®¡ç†æœåŠ¡ï¼Œå¤„ç†æ–‡ä»¶ç®¡ç†å’Œé…ç½®
- **image-cache.js**: å›¾ç‰‡ç¼“å­˜æœåŠ¡ï¼Œç®¡ç†å›¾ç‰‡ä»£ç†ç¼“å­˜
- **api-cache.js**: APIç¼“å­˜æœåŠ¡ï¼Œç®¡ç†APIè¯·æ±‚ç¼“å­˜

### å·¥å…·ç±»

- **response.js**: ç»Ÿä¸€APIå“åº”æ ¼å¼å·¥å…·

## ğŸ¯ ä¸»è¦åŠŸèƒ½

### 1. ä½œå“ä¿¡æ¯è·å–
- è·å–ä½œå“è¯¦ç»†ä¿¡æ¯
- è·å–ä½œå“é¢„è§ˆä¿¡æ¯
- è·å–ä½œå“å›¾ç‰‡URL
- æœç´¢ä½œå“

### 2. ä½œè€…ä¿¡æ¯æŸ¥è¯¢
- è·å–ä½œè€…åŸºæœ¬ä¿¡æ¯
- è·å–ä½œè€…ä½œå“åˆ—è¡¨
- è·å–ä½œè€…å…³æ³¨/ç²‰ä¸åˆ—è¡¨
- å…³æ³¨/å–æ¶ˆå…³æ³¨ä½œè€…

### 3. æ’è¡Œæ¦œåŠŸèƒ½
- è·å–æ—¥/å‘¨/æœˆæ’è¡Œæ¦œæ•°æ®
- æ”¯æŒæ’ç”»ã€æ¼«ç”»ã€å°è¯´ç±»å‹ç­›é€‰
- åˆ†é¡µæµè§ˆæ’è¡Œæ¦œä½œå“
- æ‰¹é‡ä¸‹è½½æ’è¡Œæ¦œä½œå“

### 4. æ–‡ä»¶ä¸‹è½½
- ä¸‹è½½å•ä¸ªä½œå“
- æ‰¹é‡ä¸‹è½½ä½œå“
- ä¸‹è½½ä½œè€…ä½œå“
- ä¸‹è½½è¿›åº¦è·Ÿè¸ª
- ä¸‹è½½å†å²è®°å½•

### 5. è®¤è¯ç®¡ç†
- OAuth2.0 ç™»å½•æµç¨‹
- è‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ
- ç™»å½•çŠ¶æ€ç®¡ç†

### 6. ä»“åº“ç®¡ç†
- æ–‡ä»¶å­˜å‚¨é…ç½®ç®¡ç†
- ä½œå“æ–‡ä»¶æµè§ˆå’Œæœç´¢
- æŒ‰ä½œè€…åˆ†ç±»æµè§ˆ
- æ–‡ä»¶é¢„è§ˆå’Œä¸‹è½½
- è‡ªåŠ¨è¿ç§»æ—§é¡¹ç›®
- ç£ç›˜ä½¿ç”¨æƒ…å†µç›‘æ§
- ä½œå“åˆ é™¤ç®¡ç†

### 7. å›¾ç‰‡ç¼“å­˜ç®¡ç†
- å›¾ç‰‡ä»£ç†ç¼“å­˜åŠŸèƒ½
- è‡ªåŠ¨ç¼“å­˜è¿‡æœŸæ¸…ç†
- ç¼“å­˜å¤§å°é™åˆ¶ç®¡ç†
- ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯æŸ¥çœ‹
- æ‰‹åŠ¨ç¼“å­˜æ¸…ç†åŠŸèƒ½

### 8. APIç¼“å­˜ç®¡ç†
- ä½œè€…ç›¸å…³APIè¯·æ±‚ç¼“å­˜åŠŸèƒ½
- ä½œå“æœç´¢APIè¯·æ±‚ç¼“å­˜åŠŸèƒ½
- ä½œå“è¯¦æƒ…APIè¯·æ±‚ç¼“å­˜åŠŸèƒ½
- è‡ªåŠ¨ç¼“å­˜è¿‡æœŸæ¸…ç†ï¼ˆé»˜è®¤5åˆ†é’Ÿï¼‰
- ç¼“å­˜å¤§å°é™åˆ¶ç®¡ç†ï¼ˆé»˜è®¤50MBï¼‰
- ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯æŸ¥çœ‹
- æ‰‹åŠ¨ç¼“å­˜æ¸…ç†åŠŸèƒ½
- æ”¯æŒé…ç½®ç¼“å­˜ç­–ç•¥å’Œç«¯ç‚¹ç™½åå•

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- è¯·æ±‚å‚æ•°éªŒè¯
- è®¤è¯ä¸­é—´ä»¶ä¿æŠ¤
- CORS é…ç½®
- ä»£ç†æ”¯æŒ

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

- è¯·æ±‚æ—¥å¿—è®°å½•
- é”™è¯¯æ—¥å¿—è®°å½•
- å¥åº·æ£€æŸ¥æ¥å£
- ä¸‹è½½è¿›åº¦è·Ÿè¸ª

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°è·¯ç”±

1. åœ¨ `routes/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶
2. åœ¨ `server.js` ä¸­æ³¨å†Œè·¯ç”±
3. æ·»åŠ ç›¸åº”çš„ä¸­é—´ä»¶ä¿æŠ¤

### æ·»åŠ æ–°æœåŠ¡

1. åœ¨ `services/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡ç±»
2. å®ç°ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘
3. åœ¨è·¯ç”±ä¸­è°ƒç”¨æœåŠ¡

### æ·»åŠ æ–°ä¸­é—´ä»¶

1. åœ¨ `middleware/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ä¸­é—´ä»¶æ–‡ä»¶
2. åœ¨ `server.js` ä¸­æ³¨å†Œä¸­é—´ä»¶

## ğŸ“ æ³¨æ„äº‹é¡¹

1. ç¡®ä¿ä»£ç†é…ç½®æ­£ç¡®
2. é¦–æ¬¡ä½¿ç”¨éœ€è¦ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ
3. ä¸‹è½½åŠŸèƒ½éœ€è¦è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
4. å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨PM2ç­‰è¿›ç¨‹ç®¡ç†å™¨

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT License 